<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Game T√†i X·ªâu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .dice {
            font-size: 50px;
        }
        .container {
            max-width: 600px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
<div class="container">
    <h2 class="text-center mb-4">üé≤ Game T√†i X·ªâu</h2>

    <!-- ƒêƒÉng nh·∫≠p -->
    <div id="loginContainer">
        <div class="mb-3">
            <label>T√†i kho·∫£n:</label>
            <input type="text" id="loginUsername" class="form-control">
        </div>
        <div class="mb-3">
            <label>M·∫≠t kh·∫©u:</label>
            <input type="password" id="loginPassword" class="form-control">
        </div>
        <button onclick="dangNhap()" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
        <button onclick="hienDangKy()" class="btn btn-link">ƒêƒÉng k√Ω</button>
    </div>

    <!-- ƒêƒÉng k√Ω -->
    <div id="registerContainer" style="display:none;">
        <div class="mb-3">
            <label>T√†i kho·∫£n:</label>
            <input type="text" id="regUsername" class="form-control">
        </div>
        <div class="mb-3">
            <label>M·∫≠t kh·∫©u:</label>
            <input type="password" id="regPassword" class="form-control">
        </div>
        <button onclick="dangKy()" class="btn btn-success">ƒêƒÉng k√Ω</button>
        <button onclick="hienDangNhap()" class="btn btn-link">Quay l·∫°i ƒëƒÉng nh·∫≠p</button>
    </div>

    <!-- Game -->
    <div id="gameContainer" style="display:none;">
        <div class="mb-3">
            <strong id="welcomeUser"></strong>
            <button onclick="dangXuat()" class="btn btn-danger btn-sm float-end">ƒêƒÉng xu·∫•t</button>
        </div>
        <div class="mb-3">
            <strong>S·ªë d∆∞:</strong> <span id="soDu">0</span> üí∞
            <button onclick="napTien()" class="btn btn-outline-success btn-sm ms-2">N·∫°p</button>
            <button onclick="rutTien()" class="btn btn-outline-warning btn-sm ms-1">R√∫t</button>
        </div>
        <div class="row mb-3">
            <div class="col">
                <label>Ch·ªçn c∆∞·ª£c:</label>
                <select id="cuocChon" class="form-select">
                    <option value="tai">T√†i (11-17)</option>
                    <option value="xiu">X·ªâu (4-10)</option>
                </select>
            </div>
            <div class="col">
                <label>S·ªë ti·ªÅn c∆∞·ª£c:</label>
                <input type="number" id="tienCuoc" class="form-control">
            </div>
        </div>
        <button onclick="choiTaiXiu()" class="btn btn-primary w-100">Quay X√∫c X·∫Øc üé≤</button>

        <div class="text-center my-3">
            <div class="dice" id="dice1">‚öÄ</div>
            <div class="dice" id="dice2">‚öÄ</div>
            <div class="dice" id="dice3">‚öÄ</div>
        </div>

        <div class="alert alert-info" id="gameResult">K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>

        <h5>L·ªãch s·ª≠ c∆∞·ª£c:</h5>
        <ul class="list-group" id="lichSu"></ul>
    </div>
</div>

<script>
    let soDu = 1000;
    const diceUnicode = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];

    function hienDangKy() {
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("registerContainer").style.display = "block";
    }

    function hienDangNhap() {
        document.getElementById("loginContainer").style.display = "block";
        document.getElementById("registerContainer").style.display = "none";
    }

    function dangKy() {
        const user = document.getElementById("regUsername").value.trim();
        const pass = document.getElementById("regPassword").value;
        if (!user || !pass) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        if (localStorage.getItem("user_" + user)) return alert("T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!");
        localStorage.setItem("user_" + user, JSON.stringify({ password: pass }));
        alert("ƒêƒÉng k√Ω th√†nh c√¥ng, h√£y ƒëƒÉng nh·∫≠p.");
        hienDangNhap();
    }

    function dangNhap() {
        const user = document.getElementById("loginUsername").value.trim();
        const pass = document.getElementById("loginPassword").value;
        const saved = localStorage.getItem("user_" + user);
        if (!saved) return alert("T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!");
        const data = JSON.parse(saved);
        if (data.password !== pass) return alert("Sai m·∫≠t kh·∫©u!");
        sessionStorage.setItem("username", user);
        hienThiGameTheoDangNhap();
    }

    function dangXuat() {
        sessionStorage.removeItem("username");
        alert("ƒê√£ ƒëƒÉng xu·∫•t.");
        hienDangNhap();
        document.getElementById("gameContainer").style.display = "none";
    }

    function hienThiGameTheoDangNhap() {
        const username = sessionStorage.getItem("username");
        if (username) {
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("registerContainer").style.display = "none";
            document.getElementById("gameContainer").style.display = "block";
            document.getElementById("welcomeUser").innerText = `Xin ch√†o, ${username}!`;
            const savedBalance = localStorage.getItem(username + "_balance");
            if (savedBalance !== null) soDu = parseInt(savedBalance);
            capNhatSoDu();
            loadLichSu();
        }
    }

    function capNhatSoDu() {
        document.getElementById("soDu").innerText = soDu;
        const username = sessionStorage.getItem("username");
        if (username) localStorage.setItem(username + "_balance", soDu);
    }

    function capNhatLichSu(tien, luaChon, tong, ketQua) {
        const username = sessionStorage.getItem("username");
        if (!username) return;
        let lichSuArr = JSON.parse(localStorage.getItem(username + "_lichSu")) || [];
        const item = `üíµ ƒê·∫∑t ${tien} v√†o ${luaChon.toUpperCase()} ‚Üí T·ªïng ${tong} ‚Üí ${ketQua.toUpperCase()}`;
        lichSuArr.unshift(item);
        if (lichSuArr.length > 20) lichSuArr.pop();
        localStorage.setItem(username + "_lichSu", JSON.stringify(lichSuArr));
        loadLichSu();
    }

    function loadLichSu() {
        const username = sessionStorage.getItem("username");
        if (!username) return;
        let lichSuArr = JSON.parse(localStorage.getItem(username + "_lichSu")) || [];
        const lichSuEl = document.getElementById("lichSu");
        lichSuEl.innerHTML = "";
        lichSuArr.forEach(item => {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.innerText = item;
            lichSuEl.appendChild(li);
        });
    }

    function choiTaiXiu() {
        const tien = parseInt(document.getElementById("tienCuoc").value);
        const luaChon = document.getElementById("cuocChon").value;
        if (!tien || tien <= 0) return alert("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá.");
        if (tien > soDu) return alert("Kh√¥ng ƒë·ªß s·ªë d∆∞!");

        const dice1 = Math.floor(Math.random() * 6) + 1;
        const dice2 = Math.floor(Math.random() * 6) + 1;
        const dice3 = Math.floor(Math.random() * 6) + 1;
        const tong = dice1 + dice2 + dice3;
        const ketQua = (tong >= 11 && tong <= 17) ? "tai" : "xiu";

        document.getElementById("dice1").innerText = diceUnicode[dice1 - 1];
        document.getElementById("dice2").innerText = diceUnicode[dice2 - 1];
        document.getElementById("dice3").innerText = diceUnicode[dice3 - 1];

        let ketQuaText = `T·ªïng: ${tong}\nK·∫øt qu·∫£: ${ketQua.toUpperCase()}`;
        if (luaChon === ketQua) {
            soDu += tien;
            ketQuaText += `\nüéâ B·∫°n th·∫Øng ${tien} üí∞`;
        } else {
            soDu -= tien;
            ketQuaText += `\nüí• B·∫°n thua ${tien} üí∏`;
        }

        document.getElementById("gameResult").innerText = ketQuaText;
        capNhatSoDu();
        capNhatLichSu(tien, luaChon, tong, ketQua);
    }

    function napTien() {
        let soTien = prompt("Nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p:");
        soTien = parseInt(soTien);
        if (soTien > 0) {
            soDu += soTien;
            capNhatSoDu();
            alert(`ƒê√£ n·∫°p ${soTien} th√†nh c√¥ng!`);
        }
    }

    function rutTien() {
        let soTien = prompt("Nh·∫≠p s·ªë ti·ªÅn mu·ªën r√∫t:");
        soTien = parseInt(soTien);
        if (soTien > 0 && soTien <= soDu) {
            soDu -= soTien;
            capNhatSoDu();
            alert(`ƒê√£ r√∫t ${soTien} th√†nh c√¥ng!`);
        } else {
            alert("S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng ƒë·ªß s·ªë d∆∞!");
        }
    }

    window.onload = hienThiGameTheoDangNhap;
</script>
</body>
</html>

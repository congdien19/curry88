<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game T√†i X·ªâu - K√®m L·ªãch S·ª≠ C∆∞·ª£c</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"/>

    <style>
        :root {
            --primary-color: #c0392b; /* M√†u ƒë·ªè ƒë·∫≠m */
            --secondary-color: #f1c40f; /* M√†u v√†ng */
            --bg-color: #1e3a2a; /* M√†u xanh l√° c√¢y ƒë·∫≠m (m·∫∑t b√†n) */
            --win-color: #27ae60;
            --loss-color: #e74c3c;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align top */
            min-height: 100vh;
            background-color: #111827;
            padding: 1rem;
        }

        /* --- B·ªë c·ª•c ch√≠nh --- */
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr; /* B√†n c∆∞·ª£c chi·∫øm 2 ph·∫ßn, l·ªãch s·ª≠ 1 ph·∫ßn */
            gap: 1.5rem;
            width: 100%;
            max-width: 1400px;
        }
        
        /* --- M√†n h√¨nh ƒëƒÉng nh·∫≠p --- */
        #login-screen { max-width: 400px; margin: auto; text-align: center; }
        #login-screen h1 { color: var(--secondary-color); }

        #game-container { display: none; }

        article.card {
            background-color: var(--bg-color);
            border: 3px solid var(--border-color);
            padding: 1.5rem;
        }
        .card h2 { color: var(--secondary-color); text-align: center; margin-bottom: 1.5rem; }

        /* B√†n c∆∞·ª£c */
        .player-info { display: flex; justify-content: space-between; align-items: center; }
        .dice-area { text-align: center; }
        #dice-container { display: flex; justify-content: center; gap: 20px; margin: 1rem 0; }
        .dice {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            background-color: #fff;
            color: #333;
            box-shadow: inset 0 -3px 5px rgba(0,0,0,0.3);
        }
        #result-text {
            font-weight: bold;
            color: var(--secondary-color);
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #countdown-timer { font-size: 0.9em; color: #ccc; margin-top: 5px; }
        
        /* Khu v·ª±c ƒë·∫∑t c∆∞·ª£c */
        .betting-area { display: grid; gap: 10px; margin-top: 1.5rem; }
        .bet-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        .bet-option {
            background-color: var(--primary-color);
            border: 2px solid var(--border-color);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.2s, filter 0.2s;
            position: relative;
            font-weight: bold;
        }
        .bet-option:not(:disabled):hover { transform: scale(1.05); filter: brightness(1.2); }
        .bet-option .payout { font-size: 0.8em; opacity: 0.8; font-weight: normal; }
        .bet-option .bet-placed-display {
            position: absolute; bottom: 2px; right: 5px; background: var(--secondary-color);
            color: #000; font-size: 0.9em; padding: 2px 5px; border-radius: 5px;
        }
        .grid-col-3 { grid-column: span 3; font-size: 1.5em; padding: 20px 10px; }
        .grid-col-6 { grid-column: span 6; }
        .bet-option.win { background-color: var(--win-color) !important; box-shadow: 0 0 20px var(--win-color); }
        .bet-option.lose { filter: brightness(0.5); }
        .bet-option:disabled { cursor: not-allowed; filter: grayscale(50%); }

        /* B·∫£ng l·ªãch s·ª≠ */
        #history-panel { height: fit-content; }
        #history-table { width: 100%; }
        #history-table th, #history-table td { text-align: center; }
        #history-table td.dice-result { font-family: monospace; font-size: 1.1em; letter-spacing: 2px; }
        #history-table td.win { color: var(--win-color); font-weight: bold; }
        #history-table td.loss { color: var(--loss-color); font-weight: bold; }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .main-layout { grid-template-columns: 1fr; }
            #history-panel { margin-top: 2rem; }
        }
    </style>
</head>
<body>

<main class="container" id="login-screen">
    <article class="card">
        <h1>üé≤ Ch√†o M·ª´ng ƒê·∫øn V·ªõi Game T√†i X·ªâu üé≤</h1>
        <p>Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
        <form id="login-form">
            <input type="text" id="username-input" placeholder="T√™n ng∆∞·ªùi ch∆°i" required>
            <button type="submit">V√†o Game</button>
        </form>
    </article>
</main>

<div id="game-container" class="main-layout">
    <article id="game-board" class="card">
        <h2>B√†n C∆∞·ª£c</h2>
        <div class="player-info">
            <span id="player-name"></span>
            <span id="balance"></span>
        </div>
        <div class="grid">
            <div>
                <label for="bet-amount">M·ª©c c∆∞·ª£c:</label>
                <input type="number" id="bet-amount" value="50" min="1">
            </div>
            <div class="dice-area">
                <div id="dice-container">
                    <div class="dice" id="dice1">?</div>
                    <div class="dice" id="dice2">?</div>
                    <div class="dice" id="dice3">?</div>
                </div>
                <div id="result-text">
                    <span id="result-message">H√£y ƒë·∫∑t c∆∞·ª£c!</span>
                    <div id="countdown-timer"></div>
                </div>
            </div>
        </div>
        <div class="betting-area">
             <div class="bet-grid">
                <button class="bet-option grid-col-3" data-bet-type="xiu">X·ªàU<div class="payout">4-10 (1 ƒÉn 1)</div></button>
                <button class="bet-option grid-col-3" data-bet-type="tai">T√ÄI<div class="payout">11-17 (1 ƒÉn 1)</div></button>
            </div>
        </div>
        <div class="controls" style="margin-top: 1.5rem">
            <button id="roll-btn" style="background-color: var(--secondary-color); color: #000;">L·∫Øc X√∫c X·∫Øc</button>
            <button id="reset-btn" class="secondary" disabled>C∆∞·ª£c L·∫°i</button>
        </div>
    </article>

    <article id="history-panel" class="card">
        <h2>L·ªãch S·ª≠ C∆∞·ª£c</h2>
        <div class="overflow-auto">
            <table id="history-table">
                <thead>
                    <tr>
                        <th>V√°n</th>
                        <th>X√∫c X·∫Øc</th>
                        <th>T·ªïng</th>
                        <th>K·∫øt Qu·∫£</th>
                        <th>+/- ƒêi·ªÉm</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    </tbody>
            </table>
        </div>
    </article>
</div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Elements ---
    const loginScreen = document.getElementById('login-screen');
    const loginForm = document.getElementById('login-form');
    const usernameInput = document.getElementById('username-input');
    const gameContainer = document.getElementById('game-container');
    const playerNameElem = document.getElementById('player-name');
    const balanceElem = document.getElementById('balance');
    const betAmountInput = document.getElementById('bet-amount');
    const diceElems = [document.getElementById('dice1'), document.getElementById('dice2'), document.getElementById('dice3')];
    const resultMessageElem = document.getElementById('result-message');
    const countdownTimerElem = document.getElementById('countdown-timer');
    const betOptions = document.querySelectorAll('.bet-option');
    const rollBtn = document.getElementById('roll-btn');
    const resetBtn = document.getElementById('reset-btn');
    const historyBody = document.getElementById('history-body');

    // --- Game State ---
    let playerName = '';
    let playerBalance = 1000;
    let bets = {};
    let isRoundActive = false;
    let countdownIntervalId = null;
    let gameHistory = [];
    let roundCounter = 0;

    const PAYOUTS = { tai: 1, xiu: 1 };

    // --- Functions ---
    const updateBalance = (amount) => {
        playerBalance = amount;
        balanceElem.textContent = `ƒêi·ªÉm: ${playerBalance}`;
    };
    
    const toggleControls = (active) => {
        isRoundActive = active;
        rollBtn.disabled = active;
        resetBtn.disabled = !active;
        betAmountInput.disabled = active;
        betOptions.forEach(b => b.disabled = active);
    };

    const placeBet = (betType, amount) => {
        if (isRoundActive) return;
        if (amount <= 0) { alert("M·ª©c c∆∞·ª£c kh√¥ng h·ª£p l·ªá!"); return; }
        if (amount > playerBalance) { alert("Kh√¥ng ƒë·ªß ƒëi·ªÉm!"); return; }

        updateBalance(playerBalance - amount);
        bets[betType] = (bets[betType] || 0) + amount;

        const betOptionElem = document.querySelector(`[data-bet-type='${betType}']`);
        betOptionElem.classList.add('selected');
        
        let display = betOptionElem.querySelector('.bet-placed-display');
        if (!display) {
            display = document.createElement('div');
            display.className = 'bet-placed-display';
            betOptionElem.appendChild(display);
        }
        display.textContent = bets[betType];
    };

    const rollDice = () => {
        if (Object.keys(bets).length === 0) {
            alert("Vui l√≤ng ƒë·∫∑t c∆∞·ª£c!");
            return;
        }
        toggleControls(true);
        resultMessageElem.textContent = "ƒêang l·∫Øc...";

        let rollCount = 0;
        const rollInterval = setInterval(() => {
            diceElems.forEach(d => d.textContent = Math.floor(Math.random() * 6) + 1);
            if (++rollCount > 20) {
                clearInterval(rollInterval);
                finalizeRoll();
            }
        }, 100);
    };

    const finalizeRoll = () => {
        const dice = [1, 2, 3].map(() => Math.floor(Math.random() * 6) + 1);
        const total = dice.reduce((a, b) => a + b);
        dice.forEach((val, i) => diceElems[i].textContent = val);
        checkWinnings(dice, total);
    };

    const checkWinnings = (dice, total) => {
        const isTriple = dice[0] === dice[1] && dice[1] === dice[2];
        let totalWinnings = 0;
        const totalBetAmount = Object.values(bets).reduce((sum, amount) => sum + amount, 0);

        for (const betType in bets) {
            const betAmount = bets[betType];
            let won = false;
            if (betType === 'tai' && total >= 11 && total <= 17 && !isTriple) won = true;
            else if (betType === 'xiu' && total >= 4 && total <= 10 && !isTriple) won = true;
            
            const betElem = document.querySelector(`[data-bet-type='${betType}']`);
            if (won) {
                totalWinnings += betAmount + (betAmount * PAYOUTS[betType]);
                betElem.classList.add('win');
            } else {
                betElem.classList.add('lose');
            }
        }

        updateBalance(playerBalance + totalWinnings);
        const netChange = totalWinnings - totalBetAmount;

        let resultString = `T·ªïng: ${total}. `;
        if (netChange > 0) resultString += `B·∫°n th·∫Øng ${netChange} ƒëi·ªÉm!`;
        else if (netChange < 0) resultString += `B·∫°n thua ${Math.abs(netChange)} ƒëi·ªÉm.`;
        else resultString += "B·∫°n h√≤a v·ªën.";
        
        resultMessageElem.textContent = resultString;

        // C·∫≠p nh·∫≠t l·ªãch s·ª≠
        updateHistory(dice, total, isTriple, netChange);
        startNewRoundTimer(5);
    };
    
    const updateHistory = (dice, total, isTriple, netChange) => {
        roundCounter++;
        const resultText = isTriple ? "B·ªô Ba" : (total > 10 ? "T√†i" : "X·ªâu");
        const historyEntry = {
            round: roundCounter,
            dice: dice.join('-'),
            total: total,
            result: resultText,
            change: netChange,
        };

        gameHistory.unshift(historyEntry); // Th√™m v√†o ƒë·∫ßu m·∫£ng
        if (gameHistory.length > 15) {
            gameHistory.pop(); // Gi·ªõi h·∫°n 15 v√°n
        }

        renderHistoryTable();
    };

    const renderHistoryTable = () => {
        historyBody.innerHTML = ''; // X√≥a b·∫£ng c≈©
        gameHistory.forEach(entry => {
            const row = document.createElement('tr');
            
            let changeClass = '';
            if (entry.change > 0) changeClass = 'win';
            else if (entry.change < 0) changeClass = 'loss';
            
            const changeText = entry.change > 0 ? `+${entry.change}` : entry.change;

            row.innerHTML = `
                <td>#${entry.round}</td>
                <td class="dice-result">${entry.dice}</td>
                <td>${entry.total}</td>
                <td><b>${entry.result}</b></td>
                <td class="${changeClass}">${changeText}</td>
            `;
            historyBody.appendChild(row);
        });
    };

    const startNewRoundTimer = (seconds) => {
        let remaining = seconds;
        countdownTimerElem.textContent = `V√°n m·ªõi sau: ${remaining}s`;
        countdownIntervalId = setInterval(() => {
            remaining--;
            countdownTimerElem.textContent = `V√°n m·ªõi sau: ${remaining}s`;
            if (remaining <= 0) {
                resetBoard();
            }
        }, 1000);
    };

    const resetBoard = () => {
        clearInterval(countdownIntervalId);
        countdownIntervalId = null;

        bets = {};
        betOptions.forEach(opt => {
            opt.classList.remove('selected', 'win', 'lose');
            const display = opt.querySelector('.bet-placed-display');
            if (display) display.remove();
        });

        diceElems.forEach(d => d.textContent = '?');
        resultMessageElem.textContent = "H√£y ƒë·∫∑t c∆∞·ª£c cho v√°n m·ªõi!";
        countdownTimerElem.textContent = '';
        toggleControls(false);

        if (playerBalance <= 0) {
            alert("B·∫°n ƒë√£ h·∫øt ƒëi·ªÉm! T·∫∑ng b·∫°n 500 ƒëi·ªÉm ƒë·ªÉ ch∆°i ti·∫øp.");
            updateBalance(500);
        }
    };
    
    // --- Login Logic ---
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        playerName = usernameInput.value.trim();
        if(playerName) {
            loginScreen.style.display = 'none';
            gameContainer.style.display = 'grid'; // Thay ƒë·ªïi th√†nh grid
            playerNameElem.textContent = `Ng∆∞·ªùi ch∆°i: ${playerName}`;
            updateBalance(1000);
        }
    });

    // --- Event Listeners ---
    betOptions.forEach(option => {
        option.addEventListener('click', () => {
            const betType = option.dataset.betType;
            const amount = parseInt(betAmountInput.value);
            placeBet(betType, amount);
        });
    });

    rollBtn.addEventListener('click', rollDice);
    resetBtn.addEventListener('click', resetBoard);
});
</script>

</body>
</html>

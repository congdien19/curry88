<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫ßu Cua Curry88 - All in One</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f0f2f5;
        }

        .auth-body {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        #game-screen {
            background-color: #e9ecef;
        }

        .bet-option {
            border: 3px solid #dee2e6;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: #fff;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .bet-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #0d6efd;
        }

        .bet-option img {
            max-width: 80%;
            height: auto;
            margin-bottom: 10px;
        }

        .bet-amount {
            font-weight: bold;
            color: #dc3545;
            background-color: rgba(255, 255, 0, 0.7);
            padding: 2px 8px;
            border-radius: 5px;
        }

        .bet-option.selected {
            border-color: #198754;
            background-color: #e9f5e9;
            box-shadow: 0 4px 20px rgba(25, 135, 84, 0.4);
        }

        #dice-section img {
            height: 90px;
            width: 90px;
            object-fit: contain;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }
        
        #history-list li {
            padding: 5px;
            border-bottom: 1px solid #ccc;
        }
    </style>
</head>
<body>

    <div id="login-screen" class="auth-body">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <img src="images/logo.png" alt="Curry88 Logo" class="img-fluid" style="max-width: 150px;">
                    </div>
                    <h3 class="card-title text-center mb-4">ƒêƒÉng Nh·∫≠p</h3>
                    <form id="login-form">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="username" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control" id="password" placeholder="M·∫≠t kh·∫©u" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary fw-bold">ƒêƒÉng nh·∫≠p</button>
                        </div>
                    </form>
                    <div class="text-center mt-3">
                        <p class="mb-0">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="show-register">ƒêƒÉng k√Ω ngay</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="register-screen" class="auth-body d-none">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-lg border-0">
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <img src="images/logo.png" alt="Curry88 Logo" class="img-fluid" style="max-width: 150px;">
                    </div>
                    <h3 class="card-title text-center mb-4">ƒêƒÉng K√Ω T√†i Kho·∫£n</h3>
                    <form id="register-form">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="new-username" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control" id="new-password" placeholder="M·∫≠t kh·∫©u" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success fw-bold">ƒêƒÉng k√Ω</button>
                        </div>
                    </form>
                    <div class="text-center mt-3">
                        <p class="mb-0">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="show-login">ƒêƒÉng nh·∫≠p</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="game-screen" class="d-none">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <img src="images/logo.png" alt="Curry88 Logo" height="40">
                </a>
                <div class="ms-auto text-white">
                    <span class="me-3">Ch√†o, <strong id="player-name" class="text-warning"></strong></span>
                    <span class="me-3">|</span>
                    <span class="me-3">üí∞ S·ªë d∆∞: <strong id="player-balance" class="text-success"></strong></span>
                    <button id="logout-btn" class="btn btn-danger btn-sm">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </nav>
    
        <main class="container my-4">
            <div class="row">
                <div class="col-lg-8">
                    <div id="game-board-container" class="p-3 rounded bg-light shadow">
                        <h2 class="text-center mb-3">B√†n C∆∞·ª£c</h2>
                        <div id="game-board" class="row g-3">
                            </div>
                    </div>
                </div>
    
                <div class="col-lg-4">
                    <div class="p-3 rounded bg-light shadow">
                        <h2 class="text-center mb-3">X√∫c X·∫Øc</h2>
                        <div id="dice-section" class="mb-4 d-flex justify-content-center align-items-center" style="min-height: 150px;">
                            <h3 id="initial-text">H√£y ƒë·∫∑t c∆∞·ª£c v√† x√≥c!</h3>
                        </div>
                        <div class="d-grid gap-2">
                            <button id="roll-btn" class="btn btn-primary btn-lg fw-bold">‚ö° X√ìC NGAY! ‚ö°</button>
                            <button id="reset-btn" class="btn btn-info btn-sm">Ch∆°i l·∫°i</button>
                        </div>
                    </div>
                     <div id="history" class="mt-3 p-3 rounded bg-light shadow">
                        <h4 class="text-center">L·ªãch s·ª≠ v√°n ƒë·∫•u</h4>
                        <ul id="history-list" class="list-unstyled text-center"></ul>
                     </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const loginScreen = document.getElementById('login-screen');
            const registerScreen = document.getElementById('register-screen');
            const gameScreen = document.getElementById('game-screen');
            
            const showRegisterLink = document.getElementById('show-register');
            const showLoginLink = document.getElementById('show-login');

            let currentUser = null;

            //============= PH·∫¶N ƒêI·ªÄU H∆Ø·ªöNG M√ÄN H√åNH =============//
            
            function showScreen(screenId) {
                loginScreen.classList.add('d-none');
                registerScreen.classList.add('d-none');
                gameScreen.classList.add('d-none');

                document.getElementById(screenId).classList.remove('d-none');
            }

            showRegisterLink.addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('register-screen');
            });
            
            showLoginLink.addEventListener('click', (e) => {
                e.preventDefault();
                showScreen('login-screen');
            });


            //============= PH·∫¶N X·ª¨ L√ù ƒêƒÇNG NH·∫¨P / ƒêƒÇNG K√ù =============//
            
            // X·ª≠ l√Ω Form ƒëƒÉng k√Ω
            const registerForm = document.getElementById('register-form');
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('new-username').value;
                const password = document.getElementById('new-password').value;

                let users = JSON.parse(localStorage.getItem('bau_cua_users')) || [];

                if (users.some(u => u.username === username)) {
                    alert('T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
                    return;
                }

                users.push({ username, password, balance: 10000 });
                localStorage.setItem('bau_cua_users', JSON.stringify(users));
                alert('ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');
                showScreen('login-screen');
            });

            // X·ª≠ l√Ω Form ƒëƒÉng nh·∫≠p
            const loginForm = document.getElementById('login-form');
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                const users = JSON.parse(localStorage.getItem('bau_cua_users')) || [];
                const user = users.find(u => u.username === username && u.password === password);

                if (user) {
                    currentUser = {
                        username: user.username,
                        balance: user.balance !== undefined ? user.balance : 10000
                    };
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                    startGame();
                } else {
                    alert('T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                }
            });


            //============= PH·∫¶N X·ª¨ L√ù GAME =============//

            function startGame() {
                showScreen('game-screen');

                const gameItems = [
                    { id: 'bau', name: 'B·∫ßu' }, { id: 'cua', name: 'Cua' },
                    { id: 'tom', name: 'T√¥m' }, { id: 'ca', name: 'C√°' },
                    { id: 'ga', name: 'G√†' }, { id: 'nai', name: 'Nai' }
                ];

                const gameBoard = document.getElementById('game-board');
                const diceSection = document.getElementById('dice-section');
                const rollBtn = document.getElementById('roll-btn');
                const resetBtn = document.getElementById('reset-btn');
                const playerNameSpan = document.getElementById('player-name');
                const playerBalanceSpan = document.getElementById('player-balance');
                const logoutBtn = document.getElementById('logout-btn');
                const historyList = document.getElementById('history-list');

                let currentBets = {};

                function initializeBoard() {
                    gameBoard.innerHTML = '';
                    gameItems.forEach(item => {
                        const betDiv = document.createElement('div');
                        betDiv.className = 'col-6 col-md-4 text-center';
                        betDiv.innerHTML = `
                            <div class="bet-option p-3" data-item="${item.id}">
                                <img src="images/${item.id}.png" class="img-fluid">
                                <div class="bet-amount mt-2">C∆∞·ª£c: <span id="bet-${item.id}">0</span></div>
                            </div>
                        `;
                        gameBoard.appendChild(betDiv);
                    });
                    updateUI();
                }

                function updateUI() {
                    if (!currentUser) return;
                    playerNameSpan.textContent = currentUser.username;
                    playerBalanceSpan.textContent = currentUser.balance.toLocaleString('vi-VN') + 'ƒë';
                    gameItems.forEach(item => {
                        const betAmountSpan = document.getElementById(`bet-${item.id}`);
                        if (betAmountSpan) {
                           betAmountSpan.textContent = (currentBets[item.id] || 0).toLocaleString('vi-VN') + 'ƒë';
                           const betOptionDiv = betAmountSpan.closest('.bet-option');
                           if (currentBets[item.id] > 0) {
                               betOptionDiv.classList.add('selected');
                           } else {
                               betOptionDiv.classList.remove('selected');
                           }
                        }
                    });
                }
                
                function saveUserState() {
                    if (!currentUser) return;
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    let users = JSON.parse(localStorage.getItem('bau_cua_users')) || [];
                    let userIndex = users.findIndex(u => u.username === currentUser.username);
                    if(userIndex !== -1) {
                        users[userIndex].balance = currentUser.balance;
                        localStorage.setItem('bau_cua_users', JSON.stringify(users));
                    }
                }

                gameBoard.addEventListener('click', (e) => {
                    const betOption = e.target.closest('.bet-option');
                    if (betOption) {
                        const item = betOption.dataset.item;
                        const betAmount = 1000;

                        if (currentUser.balance >= betAmount) {
                            currentUser.balance -= betAmount;
                            currentBets[item] = (currentBets[item] || 0) + betAmount;
                            updateUI();
                        } else {
                            alert('Kh√¥ng ƒë·ªß ti·ªÅn!');
                        }
                    }
                });

                rollBtn.addEventListener('click', () => {
                    if (Object.keys(currentBets).length === 0) {
                        alert('Vui l√≤ng ƒë·∫∑t c∆∞·ª£c tr∆∞·ªõc khi x√≥c!');
                        return;
                    }

                    rollBtn.disabled = true;
                    diceSection.innerHTML = `<img src="images/dice-roll.gif" alt="ƒêang x√≥c..." style="height: 120px;">`;

                    setTimeout(() => {
                        const result = [
                            gameItems[Math.floor(Math.random() * 6)],
                            gameItems[Math.floor(Math.random() * 6)],
                            gameItems[Math.floor(Math.random() * 6)]
                        ];

                        displayResults(result);
                        calculateWinnings(result);
                        updateUI();
                        saveUserState();

                        rollBtn.disabled = false;
                    }, 2000);
                });
                
                function displayResults(result) {
                    diceSection.innerHTML = '';
                    let historyHTML = '';
                    result.forEach(item => {
                        diceSection.innerHTML += `<img src="images/${item.id}.png" alt="${item.name}" class="mx-2">`;
                        historyHTML += `<img src="images/${item.id}.png" width="20" class="mx-1">`;
                    });
                    
                    const li = document.createElement('li');
                    li.innerHTML = historyHTML;
                    historyList.prepend(li);
                    if(historyList.children.length > 5) {
                        historyList.removeChild(historyList.lastChild);
                    }
                }
                
                function calculateWinnings(result) {
                    let winnings = 0;
                    const resultCounts = {};
                    result.forEach(item => { resultCounts[item.id] = (resultCounts[item.id] || 0) + 1; });

                    for (const betItem in currentBets) {
                        if (resultCounts[betItem]) {
                            const count = resultCounts[betItem];
                            const betAmount = currentBets[betItem];
                            winnings += betAmount * (count + 1);
                        }
                    }
                    
                    if (winnings > 0) {
                        alert(`üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ th·∫Øng ${winnings.toLocaleString('vi-VN')}ƒë`);
                    } else {
                        alert(`üò• R·∫•t ti·∫øc, b·∫°n kh√¥ng th·∫Øng v√≤ng n√†y.`);
                    }

                    currentUser.balance += winnings;
                    currentBets = {};
                }

                resetBtn.addEventListener('click', () => {
                    for (const item in currentBets) {
                        currentUser.balance += currentBets[item];
                    }
                    currentBets = {};
                    updateUI();
                    alert('ƒê√£ ho√†n l·∫°i ti·ªÅn c∆∞·ª£c v√† reset b√†n.');
                });
                
                logoutBtn.addEventListener('click', () => {
                    saveUserState();
                    sessionStorage.removeItem('currentUser');
                    currentUser = null;
                    showScreen('login-screen');
                });
                
                initializeBoard();
            }

            //============= KI·ªÇM TRA PHI√äN ƒêƒÇNG NH·∫¨P =============//
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                startGame();
            } else {
                showScreen('login-screen');
            }
        });
    </script>
</body>
</html>

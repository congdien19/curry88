<!DOCTYPE html>
<html>
<head>
    <title>Game T√†i X·ªâu</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #000;
            color: #fff;
        }

        .dice-icon {
            font-size: 60px;
            display: inline-block;
            width: 70px;
            text-align: center;
        }

        .result {
            font-size: 20px;
            font-weight: bold;
            white-space: pre-line;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .btn-nap {
            margin-left: 10px;
        }

        .form-control,
        .form-select {
            background-color: #222;
            color: #fff;
            border: 1px solid #444;
        }

        .form-control::placeholder {
            color: #aaa;
        }

        .list-group-item {
            background-color: #222;
            color: #fff;
            border-color: #444;
        }

        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        #gameContainer, #registerContainer {
            display: none;
        }

        .auth-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .toggle-auth {
            cursor: pointer;
            color: #0d6efd;
        }

        .toggle-auth:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<!-- ƒêƒÉng nh·∫≠p -->
<div id="loginContainer" class="auth-container text-center">
    <h2>ƒêƒÉng nh·∫≠p</h2>
    <input id="loginUsername" type="text" class="form-control mb-3" placeholder="T√™n t√†i kho·∫£n">
    <input id="loginPassword" type="password" class="form-control mb-3" placeholder="M·∫≠t kh·∫©u">
    <button class="btn btn-primary w-100" onclick="dangNhap()">ƒêƒÉng nh·∫≠p</button>
    <p class="mt-3">Ch∆∞a c√≥ t√†i kho·∫£n? <span class="toggle-auth" onclick="hienDangKy()">ƒêƒÉng k√Ω</span></p>
</div>

<!-- ƒêƒÉng k√Ω -->
<div id="registerContainer" class="auth-container text-center">
    <h2>ƒêƒÉng k√Ω</h2>
    <input id="regUsername" type="text" class="form-control mb-3" placeholder="T√™n t√†i kho·∫£n">
    <input id="regPassword" type="password" class="form-control mb-3" placeholder="M·∫≠t kh·∫©u">
    <button class="btn btn-success w-100" onclick="dangKy()">ƒêƒÉng k√Ω</button>
    <p class="mt-3">ƒê√£ c√≥ t√†i kho·∫£n? <span class="toggle-auth" onclick="hienDangNhap()">ƒêƒÉng nh·∫≠p</span></p>
</div>

<!-- Game -->
<div id="gameContainer" class="container py-5">
    <div class="top-bar">
        <h1 class="text-center">üé≤ Game T√†i X·ªâu - Curry88</h1>
        <div>
            <span id="welcomeUser" class="me-3"></span>
            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User" class="user-icon">
            <button class="btn btn-danger btn-sm ms-2" onclick="dangXuat()">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <div class="row mb-4 justify-content-center">
        <div class="col-md-6">
            <label for="tienCuoc">S·ªë ti·ªÅn c∆∞·ª£c:</label>
            <input type="number" id="tienCuoc" class="form-control" placeholder="Nh·∫≠p s·ªë ti·ªÅn...">
        </div>
        <div class="col-md-6">
            <label for="cuocChon">Ch·ªçn c∆∞·ª£c:</label>
            <select id="cuocChon" class="form-select">
                <option value="tai">T√†i</option>
                <option value="xiu">X·ªâu</option>
            </select>
        </div>
    </div>

    <div class="text-center mb-3">
        <button id="btnQuay" class="btn btn-success btn-lg" onclick="choiTaiXiu()">Quay</button>
        <p id="countdown" class="mt-2 text-warning"></p>
    </div>

    <div class="text-center">
        <span id="dice1" class="dice-icon me-2">üé≤</span>
        <span id="dice2" class="dice-icon me-2">üé≤</span>
        <span id="dice3" class="dice-icon">üé≤</span>
        <div id="gameResult" class="result mt-3"></div>
    </div>

    <div class="mt-4 d-flex align-items-center">
        <h4 class="mb-0">S·ªë d∆∞: <span id="soDu">1000</span> üí∞</h4>
        <button class="btn btn-warning btn-sm btn-nap" onclick="napTien()">N·∫°p ti·ªÅn</button>
        <button class="btn btn-danger btn-sm btn-nap" onclick="rutTien()">R√∫t ti·ªÅn</button>
    </div>

    <div class="mt-3">
        <h5>L·ªãch s·ª≠:</h5>
        <ul id="lichSu" class="list-group text-light"></ul>
    </div>
</div>

<script>
    let soDu = 1000;
    const diceUnicode = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];

    function hienDangKy() {
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("registerContainer").style.display = "block";
    }

    function hienDangNhap() {
        document.getElementById("loginContainer").style.display = "block";
        document.getElementById("registerContainer").style.display = "none";
    }

    function dangKy() {
        const user = document.getElementById("regUsername").value.trim();
        const pass = document.getElementById("regPassword").value;

        if (!user || !pass) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");

        if (localStorage.getItem("user_" + user)) {
            return alert("T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!");
        }

        localStorage.setItem("user_" + user, JSON.stringify({ password: pass }));
        alert("ƒêƒÉng k√Ω th√†nh c√¥ng, h√£y ƒëƒÉng nh·∫≠p.");
        hienDangNhap();
    }

    function dangNhap() {
        const user = document.getElementById("loginUsername").value.trim();
        const pass = document.getElementById("loginPassword").value;

        const saved = localStorage.getItem("user_" + user);
        if (!saved) return alert("T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i!");

        const data = JSON.parse(saved);
        if (data.password !== pass) return alert("Sai m·∫≠t kh·∫©u!");

        sessionStorage.setItem("username", user);
        hienThiGameTheoDangNhap();
    }

    function dangXuat() {
        sessionStorage.removeItem("username");
        alert("ƒê√£ ƒëƒÉng xu·∫•t.");
        hienDangNhap();
        document.getElementById("gameContainer").style.display = "none";
    }

    function hienThiGameTheoDangNhap() {
        const username = sessionStorage.getItem("username");
        if (username) {
            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("registerContainer").style.display = "none";
            document.getElementById("gameContainer").style.display = "block";
            document.getElementById("welcomeUser").innerText = `Xin ch√†o, ${username}!`;

            const savedBalance = localStorage.getItem(username + "_balance");
            if (savedBalance !== null) soDu = parseInt(savedBalance);

            capNhatSoDu();
            loadLichSu();
        }
    }

    function capNhatSoDu() {
        document.getElementById("soDu").innerText = soDu;
        const username = sessionStorage.getItem("username");
        if (username) localStorage.setItem(username + "_balance", soDu);
    }

    function capNhatLichSu(tien, luaChon, tong, ketQua) {
        const username = sessionStorage.getItem("username");
        if (!username) return;
        let lichSuArr = JSON.parse(localStorage.getItem(username + "_lichSu")) || [];
        const item = `üíµ ƒê·∫∑t ${tien} v√†o ${luaChon.toUpperCase()} ‚Üí T·ªïng ${tong} ‚Üí ${ketQua}`;
        lichSuArr.unshift(item);
        if (lichSuArr.length > 20) lichSuArr.pop();
        localStorage.setItem(username + "_lichSu", JSON.stringify(lichSuArr));
        loadLichSu();
    }

    function loadLichSu() {
        const username = sessionStorage.getItem("username");
        if (!username) return;
        let lichSuArr = JSON.parse(localStorage.getItem(username + "_lichSu")) || [];
        const lichSuList = document.getElementById("lichSu");
        lichSuList.innerHTML = "";
        lichSuArr.forEach(text => {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.textContent = text;
            lichSuList.appendChild(li);
        });
    }

    function demNguoc() {
        let time = 3;
        const interval = setInterval(() => {
            document.getElementById("countdown").innerText = `‚è≥ ƒê·ª£i ${time--}s ƒë·ªÉ ch∆°i ti·∫øp...`;
            if (time < 0) {
                clearInterval(interval);
                document.getElementById("btnQuay").disabled = false;
                document.getElementById("countdown").innerText = "";
            }
        }, 1000);
    }

    function rollAnimation(callback) {
        let count = 0;
        const interval = setInterval(() => {
            document.getElementById("dice1").textContent = diceUnicode[Math.floor(Math.random() * 6)];
            document.getElementById("dice2").textContent = diceUnicode[Math.floor(Math.random() * 6)];
            document.getElementById("dice3").textContent = diceUnicode[Math.floor(Math.random() * 6)];
            count++;
            if (count >= 15) {
                clearInterval(interval);
                callback();
            }
        }, 100);
    }

    function choiTaiXiu() {
        const datCuoc = document.getElementById("cuocChon").value;
        const tienCuoc = parseInt(document.getElementById("tienCuoc").value);

        if (!tienCuoc || tienCuoc <= 0) return alert("S·ªë ti·ªÅn c∆∞·ª£c kh√¥ng h·ª£p l·ªá.");
        if (tienCuoc > soDu) return alert("Kh√¥ng ƒë·ªß ti·ªÅn ƒë·ªÉ c∆∞·ª£c.");

        document.getElementById("btnQuay").disabled = true;
        document.getElementById("gameResult").innerText = "";
        document.getElementById("countdown").innerText = "";

        rollAnimation(() => {
            const x1 = Math.floor(Math.random() * 6) + 1;
            const x2 = Math.floor(Math.random() * 6) + 1;
            const x3 = Math.floor(Math.random() * 6) + 1;

            document.getElementById("dice1").textContent = diceUnicode[x1 - 1];
            document.getElementById("dice2").textContent = diceUnicode[x2 - 1];
            document.getElementById("dice3").textContent = diceUnicode[x3 - 1];

            const tong = x1 + x2 + x3;
            const ketQua = (tong >= 4 && tong <= 10) ? "xiu" : "tai";
            let ketQuaText = `T·ªïng: ${tong} ‚Üí ${ketQua.toUpperCase()}`;

            if (ketQua === datCuoc) {
                soDu += tienCuoc;
                ketQuaText += `\n‚úÖ B·∫°n ƒë√£ th·∫Øng +${tienCuoc}üí∞`;
            } else {
                soDu -= tienCuoc;
                ketQuaText += `\n‚ùå B·∫°n ƒë√£ thua -${tienCuoc}üí∞`;
            }

            document.getElementById("gameResult").innerText = ketQuaText;
            capNhatSoDu();
            capNhatLichSu(tienCuoc, datCuoc, tong, ketQuaText);
            demNguoc();

            document.getElementById("tienCuoc").value = '';
        });
    }

    function napTien() {
        const themTien = prompt("Nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p:");
        const soTien = parseInt(themTien);
        if (!soTien || soTien <= 0) return alert("S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá.");
        soDu += soTien;
        capNhatSoDu();
        alert(`üéâ N·∫°p th√†nh c√¥ng ${soTien}üí∞!`);
    }

    function rutTien() {
        const rut = prompt("Nh·∫≠p s·ªë ti·ªÅn mu·ªën r√∫t:");
        const soTien = parseInt(rut);
        if (!soTien || soTien <= 0) return alert("S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá.");
        if (soTien > soDu) return alert("Kh√¥ng ƒë·ªß ti·ªÅn ƒë·ªÉ r√∫t.");

        const taiKhoan = prompt("Nh·∫≠p s·ªë t√†i kho·∫£n nh·∫≠n ti·ªÅn:");
        if (!taiKhoan || taiKhoan.trim() === "") return alert("B·∫°n ph·∫£i nh·∫≠p s·ªë t√†i kho·∫£n!");

        soDu -= soTien;
        capNhatSoDu();
        alert(`üí∏ R√∫t th√†nh c√¥ng ${soTien}üí∞ v√†o TK ${taiKhoan}!`);
    }

    window.onload = () => {
        const username = sessionStorage.getItem("username");
        if (username) hienThiGameTheoDangNhap();
        else hienDangNhap();
    }
</script>
</body>
</html>
